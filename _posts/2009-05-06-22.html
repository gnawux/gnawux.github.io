--- 
meta: 
  _edit_last: "1"
published: true
title: !binary |
  SERGU+mAgOacjeiKgueCueeahOaWueazlQ==

status: publish
layout: post
type: post
tags: 
- hadoop
- hdfs
- !binary |
  566h55CG

---
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">目前版本的dfsadmin的帮助信息是没写清楚的，已经</span></span></span><a href="http://https//issues.apache.org/jira/browse/HADOOP-5778" target="_blank">file了一个bug</a><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">了，正确的方法如下：

1. </span>将<span class="921042102-06052009"> dfs.hosts  置为当前的 slaves，文件名用完整路径，注意，列表中的节点主机名要用大名，即 uname -n 可以得到的那个。</span></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">2. 将 slaves 中要被退服的节点的全名列表放在另一个文件里，如 slaves.ex，使用  dfs.host.exclude 参数指向这个文件的完整路径</span></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">3. 运行命令 bin/hadoop dfsadmin  -refreshNodes</span></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">4. web界面或 bin/hadoop dfsadmin -report 可以看到退服节点的状态是  Decomission in progress，直到需要复制的数据复制完成为止</span></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">5. 完成之后，从 slaves 里（指 dfs.hosts  指向的文件）去掉已经退服的节点</span></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">附带说一下 -refreshNodes  命令的另外三种用途：</span></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">2. 添加允许的节点到列表中（添加主机名到 dfs.hosts  里来）</span></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">3. 直接去掉节点，不做数据副本备份（在 dfs.hosts  里去掉主机名）</span></span></span></div>
<div style="color: #000000;" dir="ltr"><span style="font-family: 宋体;"><span style="font-size: x-small;"><span class="921042102-06052009">4. 退服的逆操作——停止 exclude 里面和 dfs.hosts 里面都有的，正在进行  decomission 的节点的退服，也就是把 Decomission in progress 的节点重新变为 Normal （在 web 界面叫 in  service)</span></span></span></div>
