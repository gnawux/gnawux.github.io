---
layout: post
title: SmoothWall Exp 3 安装札记
date: 2008-12-07 14:58:00.000000000 +08:00
categories:
- works
tags:
- install
- linux
- works
status: publish
type: post
published: true
meta: {}
author:
  login: gnawux
  email: gnawux@gmail.com
  display_name: gnawux
  first_name: ''
  last_name: ''
---
<p>按，与其说是安装，不如说是灌输，由于硬件支持性、软件版本等原因，无法实施正常安装，因此，退而求其次，进行了这次“灌输+激活”的“非典型”安装。   <br />问题描述    <br />1 内核支持问题：    <br />SW的内核是打过补丁的 2.6.16内核，对于我们的计算机来说它的问题是网卡不支持，无法继续安装。目前回想看，重新编译SW的时候单独采用更新的网卡驱动可能可以，不过，当时采用了另一个极端手段——更新内核版本，于是遇到了下一个问题（即使不遇到问题2，问题3可能也无法避免）。    <br />2 补丁兼容性问题：    <br />最大的问题来自 openswan 补丁，该补丁，尤其是 NAT-T，和选用的 2.6.25 内核的 udp 部分似乎存在某种尚未解决的 bug，手工修订了半天，但无法证明效果    <br />3 软件版本一致性问题：    <br />由于 SW 指定的某些软件源无法获取软件包，不得不下载了版本尽量接近的软件来代替，但不知道是否会有依赖性问题。    <br />综合上述问题，但尚未确定哪个是最终导致问题的问题，重新编译的 SW 无法正常安装，于是，我采用了下面的手段。    <br />灌输系统    <br />1 在虚拟机中安装 SW3-devel    <br />2 用移动硬盘引导目标系统，分区并挂载要安装 SW 的分区    <br />3 用 tar+ssh，将虚拟机中的内容悉数原样复制到目标系统    <br />4 将移动硬盘的内核（vmlinuz, initrd, modules）复制给目标机，重新写lilo，让系统可引导    <br />5 在新机器上编译新版本内核 （2.5.25），打开必要的 netfilter 相关选项    <br />6 sw3-devel 里没有 mkinitrd/initramfs，因此，应把启动需要的 ata/scsi/sata/ext3 等相关选项全部编译到内核里，而不是编译成模块；编译完成后，再次重写 lilo，以引导新内核。    <br />5 修改配置文件，包括</p>
<p>/var/smoothwall/main/settings   <br />/var/smoothwall/ethernet/settings    <br />/etc/fstab</p>
<p>&#160; 至此，配置完成，但应注意，如果 /var/smoothwall 不是属于 nobody 用户的的话，请重新修改此目录的权限，保证将来可以通过web管理界面管理设置。   <br />6 如果出现问题，请注意查阅日志解决</p>
